<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>üç∞ Difendi la Torta</title>
<style>
html,body{margin:0;overflow:hidden;background:#fff7ec;font-family:system-ui}
#ui{position:fixed;top:10px;left:50%;transform:translateX(-50%);font-weight:700;color:#a66}
#msg{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);color:#844}
canvas{display:block;margin:auto}
</style>
</head>
<body>

<div id="ui">Ospiti fermati: 0</div>
<div id="msg">Tocca per iniziare</div>
<canvas id="game"></canvas>

<script>
(() => {
const c=document.getElementById("game");
const ctx=c.getContext("2d");
const ui=document.getElementById("ui");
const msg=document.getElementById("msg");

function resize(){
  c.width=Math.min(innerWidth,420);
  c.height=500;
}
resize(); addEventListener("resize",resize);

let running=false, gameOver=false;
let score=0, frame=0;
let spawnRate=80;

const cake={x:0,y:0,r:35};
function resetCake(){
  cake.x=c.width/2;
  cake.y=c.height/2;
}
resetCake();

let guests=[];

function spawnGuest(){
  const angle=Math.random()*Math.PI*2;
  guests.push({
    x: cake.x + Math.cos(angle)*300,
    y: cake.y + Math.sin(angle)*300,
    r:18,
    speed:1.2 + score*0.02
  });
}

function update(){
  if(!running) return;

  frame++;
  if(frame%Math.max(20,spawnRate)==0){
    spawnGuest();
    spawnRate *= 0.995; // aumenta spawn
  }

  guests.forEach(g=>{
    const dx=cake.x-g.x, dy=cake.y-g.y;
    const d=Math.hypot(dx,dy);
    g.x+=dx/d*g.speed;
    g.y+=dy/d*g.speed;
    if(d<cake.r){
      running=false;
      gameOver=true;
      msg.textContent="üç∞ Torta divorata! Tocca per riprovare";
    }
  });

  ui.textContent="Ospiti fermati: "+score;
}

function draw(){
  ctx.clearRect(0,0,c.width,c.height);

  // torta
  ctx.fillStyle="#f9c";
  ctx.beginPath();
  ctx.arc(cake.x,cake.y,cake.r,0,Math.PI*2);
  ctx.fill();

  // ospiti
  ctx.fillStyle="#c66";
  guests.forEach(g=>{
    ctx.beginPath();
    ctx.arc(g.x,g.y,g.r,0,Math.PI*2);
    ctx.fill();
  });
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();

c.addEventListener("mousedown", e=>{
  const rect=c.getBoundingClientRect();
  const x=e.clientX-rect.left;
  const y=e.clientY-rect.top;

  if(!running){
    if(gameOver){
      guests=[];
      score=0;
      spawnRate=80;
      gameOver=false;
    }
    running=true;
    msg.textContent="";
    return;
  }

  guests=guests.filter(g=>{
    if(Math.hypot(g.x-x,g.y-y)<g.r){
      score++;
      return false;
    }
    return true;
  });
});
})();
</script>
</body>
</html>
