<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Fill the Mug Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Roboto Condensed', sans-serif;
      background: #fafafa;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      overflow: hidden; /* niente scroll */
    }

    h1,h2,h3 { font-family: 'Germania One', Arial,sans-serif; margin:5px 0; text-align:center; }
    h1 { font-size: 2.5rem; }
    h2 { font-size: 1.2rem; }
    h3 { font-size: 1rem; }

    .helper { text-align:center; font-size:0.9rem; }

    /* contenitore principale */
    #game-wrapper {
      display:flex;
      flex-direction: row;
      align-items: flex-start;
      justify-content: center;
      gap: 20px;
      transform: scale(1);
      transform-origin: center;
    }

    /* rubinetto */
    #tap-container { position:relative; }
    #tap { width:120px; background: #ddd; height:35px; margin:140px 0 0 0; position:relative; border-top-left-radius:5px; border-bottom-left-radius:5px; }
    #tap:after { content:""; display:block; position:absolute; border-top: 70px solid #ddd; border-left: 10px solid transparent; border-right: 10px solid transparent; border-radius:0 0 40px 40px; height: 0; width: 20px; top:10px; right:10px; transform:rotate(-20deg); z-index:2; }
    #tap:before { content:""; display:block; position:absolute; width:70px; height:60px; background:grey; left:-20px; top:-15px; border-radius: 0px 20px 20px 0px; }
    
    #handle { border-top: 100px solid black; border-left: 10px solid transparent; border-right: 10px solid transparent; width:20px; position:absolute; top:30px; left:80px; border-radius: 10px 10px 0 0; z-index:3; transition: transform 0.3s ease; }
    #handle:before { content:""; display:block; width:30px; height:30px; background:lightgrey; position:absolute; bottom:-20px; left:-5px; border-radius:20px 20px 10px 10px }
    #handle:hover { transform:rotate(6deg); transform-origin: center bottom; }
    
    #pour { position:absolute; left:92px; top:210px; width:16px; height:0px; z-index:1; background:rgba(229,197,57,1); transition:0s; }
    #pour.pouring { height:230px; transition:800ms ease; }

    /* bicchiere */
    #mug-container { position:relative; }
    #mug { margin:60px 0 0 0; border:20px solid #eee; border-bottom-width:30px; width:120px; height:200px; border-top:none; border-radius: 0 0 10px 10px; position:relative; }
    #mug:before { position:absolute; content:""; display:block; bottom:-40px; height:30px; width:180px; left:-30px; background:#eee; }
    #mug:after { position:absolute; content:""; display:block; right:-80px; top:30px; width:40px; height:110px; border:25px solid #eee; border-left:none; border-radius:0 50px 150px 0; }

    #beer { width:100%; height:0%; max-height:100%; background: linear-gradient( rgba(255,255,255,1) 0%, rgba(255,255,255,1) 35%, rgba(237,237,173,1) 43%, rgba(229,197,57,1) 44%, rgba(229,197,57,1) 100% ); background-repeat: repeat; background-size:100% 200%; position:absolute; bottom:0; left:0; }
    @keyframes beerFill { 5% { height:0%; } 100% { height:100%; } }
    #beer.fill { animation-name:beerFill; animation-duration:10s; animation-fill-mode:forwards; background-position:0% 70%; }

    /* RESPONSIVE */
    @media (max-width: 768px) {
      h1 { font-size: 2rem; }
      #game-wrapper { transform: scale(0.8); }
    }
    @media (max-width: 480px) {
      h1 { font-size: 1.6rem; }
      #game-wrapper { flex-direction: column; gap:30px; transform: scale(0.8); }
    }
  </style>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

  <h1>Fill the mug <span id="target">0</span>%</h1>
  <h2 id="percent-filled"></h2>
  <h3 id="result"></h3>
  <p class="helper">Hover sul rubinetto per riempire â€¢ Tap sul bicchiere per resettare</p>

  <div id="game-wrapper">
    <div id="tap-container">
      <div id="tap"></div>
      <div id="handle"></div>
      <div id="pour"></div>
    </div>

    <div id="mug-container">
      <div id="mug">
        <div id="beer"></div>
      </div>
    </div>
  </div>

  <script>
    var mugHeight;
    var beerHeight;
    var percentFilled;
    var roundedPercent;
    var game = Math.floor((Math.random() * 100) + 1);

    function getHeights(){
      mugHeight = $('#mug').height();
      beerHeight = $('#beer').height();
      percentFilled = (beerHeight / mugHeight) * 100;
      roundedPercent = Math.round(percentFilled);
      $('#percent-filled').html('Percent Filled: ' + roundedPercent + '%');
    };

    $('#handle').hover(
      function(){
        $('#beer').addClass('fill');
        $('#beer').css('animation-play-state', 'running');
        $('#pour').addClass('pouring');
      },
      function(){
        getHeights();
        $('#beer').css('animation-play-state', 'paused');
        $('#pour').removeClass('pouring');
        if (roundedPercent === 0) {
          // do nothing
        } else if (roundedPercent === game) {
          $('#result').html('Nailed it! Good job!');
        } else if((game - roundedPercent) < 5 && (game - roundedPercent) > -5 ){
          $('#result').html('Eh. Close enough.');
        } else {
          $('#result').html('You stink');
        }
      }
    );

    $('#mug').click(function(){
      $('#beer').removeClass('fill');
      getHeights();
      $('#result').html('');
      game = Math.floor((Math.random() * 100) + 1);
      $('#target').html(game);
    });

    $(document).ready(function(){
      $('#target').html(game);
    });
  </script>
</body>
</html>
