<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>üíç Raccogli le fedi</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap');
  body, html {
    margin: 0; padding: 0; overflow: hidden;
    background: linear-gradient(180deg, #cce7ff, #fdf7f0);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    user-select: none;
  }
  #gameCanvas {
    display: block;
    margin: auto;
    background: #fffef8;
    border: 4px solid #b99868;
    border-radius: 14px;
    touch-action: none;
    box-shadow: 0 0 12px rgba(185, 153, 80, 0.6);
  }
  #scoreDisplay {
    position: fixed;
    top: 10px; left: 50%;
    transform: translateX(-50%);
    font-size: 1.6rem;
    font-weight: 700;
    color: #b99868;
    text-shadow: 0 0 5px #fff;
    font-family: 'Great Vibes', cursive;
    user-select: none;
  }
  #message {
    position: fixed;
    bottom: 20px; left: 50%;
    transform: translateX(-50%);
    font-size: 1.2rem;
    color: #8a6d36;
    font-weight: 600;
    user-select: none;
  }
</style>
</head>
<body>

<div id="scoreDisplay">Fedi raccolte: 0</div>
<canvas id="gameCanvas"></canvas>
<div id="message">Caricamento immagini‚Ä¶</div>

<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const scoreDisplay = document.getElementById('scoreDisplay');
  const message = document.getElementById('message');

  function resize() {
    const w = Math.min(window.innerWidth, 400);
    const h = Math.min(window.innerHeight - 60, 600);
    canvas.width = w;
    canvas.height = h;
  }
  resize();
  window.addEventListener('resize', resize);

  // Immagini base64
  const sposoImgSrc = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAQAAAAAYLlVAAAArklEQVR4Ae3WMQ6CMBQE0Afv9N9g+LDoZXZLYca7A4IxQm+wEsfIN7N9+9bLYWJH4iG7DZxFp+f1gLgN6E7/gs0Ql8CrB5cCzgk8BVAznvgBhQbG+x1kDq6ECQ+4D9IP+AQiMc4Db3g6wrEWCU2DLAaPwEX6wc6Esh5TsFy4DB1sIyThhPAXaT8IU5uX9QRh+JjffyG0NMLFwAAAABJRU5ErkJggg==';
  const sposaImgSrc = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAQAAAAAYLlVAAAAmklEQVR4Ae3WsQ2DMAxE0cH0E3Yr4DY+0PJwYZdOxGOI48gk6UvI8U7/u+Yk5OBIp5oV3sAxWuDV6OHXn7mSh7hlLXeB7YDCMEr7p4KXzW8VX3BQYENsG1sADHL/c3HGfjTpOBaNawFoh60Xs4M9KBV1zBTqs9SqE0dkCrK9DHINqnwNX+j5DRRWG4yY4Kmc9LRWdoLDBXs1wD3+a51bgqR4sKPEAAAAASUVORK5CYII=';
  const ringImgSrc = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAv0lEQVR42mNgGAWjYBSMglEwCqP9n8E4n9E8Hmfi4v/q6XAfYH1MxNCJgPCo6H+48D4nBF5r4B+o5LEL8g8QfE9TJH7g/efxN8Ff2VgyQIlIgoD//79u9Jc5P+H7KbgwUIzAsD/QAZWzkAQQ3GgFoJoAyNcQkA3BxHiWA7qkM8v+x+ws0Gr6v2wNu/55MSxkJ/ALMr7TiBHBYkAAAAASUVORK5CYII=';

  const sposoImg = new Image();
  const sposaImg = new Image();
  const ringImg = new Image();

  let imagesLoaded = 0;
  const totalImages = 3;

  function checkAllLoaded() {
    imagesLoaded++;
    if (imagesLoaded === totalImages) {
      message.textContent = "Aiuta lo sposo o la sposa a raccogliere tutte le fedi!";
      startGame();
    }
  }

  sposoImg.onload = checkAllLoaded;
  sposaImg.onload = checkAllLoaded;
  ringImg.onload = checkAllLoaded;

  sposoImg.src = sposoImgSrc;
  sposaImg.src = sposaImgSrc;
  ringImg.src = ringImgSrc;

  // Variabili gioco
  let player = null;
  let rings = [];
  let spawnTimer = 0;
  const spawnInterval = 1000;
  let lastTime = 0;
  let score = 0;

  function newPlayer() {
    const characters = [
      { img: sposoImg, width: 60, height: 80 },
      { img: sposaImg, width: 60, height: 80 }
    ];
    player = { ...characters[Math.floor(Math.random() * characters.length)] };
    player.x = canvas.width / 2 - player.width / 2;
    player.y = canvas.height - player.height - 20;
    player.speed = 8;
    player.targetX = null;
  }

  function spawnRing() {
    const x = ringImg.width/2 + Math.random() * (canvas.width - ringImg.width);
    rings.push({ x, y: -ringImg.height, width: ringImg.width, height: ringImg.height, speed: 2 + Math.random() });
  }

  function collision(ring) {
    return !(ring.x + ring.width < player.x ||
             ring.x > player.x + player.width ||
             ring.y + ring.height < player.y ||
             ring.y > player.y + player.height);
  }

  function update(delta) {
    if (!player) return;

    if (player.targetX !== null) {
      const dx = player.targetX - player.x;
      if (Math.abs(dx) < player.speed) {
        player.x = player.targetX;
        player.targetX = null;
      } else {
        player.x += (dx > 0 ? player.speed : -player.speed);
      }
    }

    if (player.x < 0) player.x = 0;
    if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;

    spawnTimer += delta;
    if (spawnTimer > spawnInterval) {
      spawnTimer = 0;
      spawnRing();
    }

    for (let i = rings.length - 1; i >= 0; i--) {
      rings[i].y += rings[i].speed;
      if (rings[i].y - rings[i].height > canvas.height) {
        rings.splice(i, 1);
        continue;
      }
      if (collision(rings[i])) {
        rings.splice(i, 1);
        score++;
        scoreDisplay.textContent = `Fedi raccolte: ${score}`;
        if(score === 1) message.textContent = "Bravo! Continua cos√¨!";
        else if(score === 5) message.textContent = "Sei un vero raccoglitore d'amore!";
        else if(score === 10) message.textContent = "L'anima gemella ti applaude! üíï";
      }
    }
  }

  function draw() {
    if (!player) return;
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Sfondo gradiente
    const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
    grad.addColorStop(0, '#cce7ff');
    grad.addColorStop(1, '#fdf7f0');
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Disegna fedi
    rings.forEach(r => ctx.drawImage(ringImg, r.x - r.width / 2, r.y - r.height / 2, r.width, r.height));

    // Disegna player
    ctx.drawImage(player.img, player.x, player.y, player.width, player.height);
  }

  function gameLoop(timestamp = 0) {
    if (!lastTime) lastTime = timestamp;
    const delta = timestamp - lastTime;
    lastTime = timestamp;

    update(delta);
    draw();
    requestAnimationFrame(gameLoop);
  }

  function onInput(event) {
    if (!player) return;
    const rect = canvas.getBoundingClientRect();
    let x;
    if(event.touches) x = event.touches[0].clientX - rect.left;
    else x = event.clientX - rect.left;

    player.targetX = (x < canvas.width / 2) ? 20 : canvas.width - player.width - 20;
  }

  canvas.addEventListener('touchstart', onInput);
  canvas.addEventListener('mousedown', onInput);

  function startGame() {
    score = 0;
    scoreDisplay.textContent = `Fedi raccolte: ${score}`;
    rings.length = 0;
    newPlayer();
    gameLoop();
  }
})();
</script>

</body>
</html>
