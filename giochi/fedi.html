<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>üíç Raccogli le fedi - versione canvas pura</title>
<style>
  body, html {
    margin: 0; padding: 0; overflow: hidden;
    background: linear-gradient(180deg, #cce7ff, #fdf7f0);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    user-select: none;
  }
  #gameCanvas {
    display: block;
    margin: auto;
    background: #fffef8;
    border: 4px solid #b99868;
    border-radius: 14px;
    touch-action: none;
    box-shadow: 0 0 12px rgba(185, 153, 80, 0.6);
  }
  #scoreDisplay {
    position: fixed;
    top: 10px; left: 50%;
    transform: translateX(-50%);
    font-size: 1.6rem;
    font-weight: 700;
    color: #b99868;
    text-shadow: 0 0 5px #fff;
    user-select: none;
  }
  #message {
    position: fixed;
    bottom: 20px; left: 50%;
    transform: translateX(-50%);
    font-size: 1.2rem;
    color: #8a6d36;
    font-weight: 600;
    user-select: none;
  }
</style>
</head>
<body>

<div id="scoreDisplay">Fedi raccolte: 0</div>
<canvas id="gameCanvas"></canvas>
<div id="message">Aiuta lo sposo o la sposa a raccogliere tutte le fedi!</div>

<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const scoreDisplay = document.getElementById('scoreDisplay');
  const message = document.getElementById('message');

  function resize() {
    const w = Math.min(window.innerWidth, 400);
    const h = Math.min(window.innerHeight - 60, 600);
    canvas.width = w;
    canvas.height = h;
  }
  resize();
  window.addEventListener('resize', resize);

  // Player e fedine disegnati a mano con canvas

  // Player: sposo o sposa casuale
  let player = null;
  const playerWidth = 60;
  const playerHeight = 80;

  function drawSposo(x, y) {
    ctx.fillStyle = '#2b3e50'; // abito blu scuro
    ctx.fillRect(x + 20, y + 40, 20, 35); // corpo
    ctx.beginPath(); // testa
    ctx.fillStyle = '#f9d5b3';
    ctx.arc(x + 30, y + 20, 15, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = '#000';
    ctx.fillRect(x + 22, y + 43, 5, 5); // cravatta
    ctx.fillRect(x + 33, y + 43, 5, 5);
  }

  function drawSposa(x, y) {
    ctx.fillStyle = '#f5f0e6'; // vestito bianco
    ctx.beginPath();
    ctx.moveTo(x + 10, y + 70);
    ctx.lineTo(x + 30, y + 40);
    ctx.lineTo(x + 50, y + 70);
    ctx.closePath();
    ctx.fill();
    ctx.beginPath(); // testa
    ctx.fillStyle = '#f9d5b3';
    ctx.arc(x + 30, y + 20, 15, 0, Math.PI * 2);
    ctx.fill();
  }

  function newPlayer() {
    if(Math.random() < 0.5) {
      player = { type: 'sposo', x: canvas.width / 2 - playerWidth / 2, y: canvas.height - playerHeight - 20, width: playerWidth, height: playerHeight };
    } else {
      player = { type: 'sposa', x: canvas.width / 2 - playerWidth / 2, y: canvas.height - playerHeight - 20, width: playerWidth, height: playerHeight };
    }
    player.speed = 8;
    player.targetX = null;
  }

  // Fedina: cerchio dorato
  class Ring {
    constructor(x, y) {
      this.x = x;
      this.y = y;
      this.radius = 15;
      this.speed = 2 + Math.random();
    }
    update() {
      this.y += this.speed;
    }
    draw() {
      // cerchio esterno oro
      ctx.beginPath();
      ctx.strokeStyle = '#b99868';
      ctx.lineWidth = 5;
      ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
      ctx.stroke();
      // cerchio interno bianco
      ctx.beginPath();
      ctx.strokeStyle = '#fffef8';
      ctx.lineWidth = 4;
      ctx.arc(this.x, this.y, this.radius - 6, 0, Math.PI * 2);
      ctx.stroke();
    }
    getRect() {
      return { x: this.x - this.radius, y: this.y - this.radius, width: this.radius*2, height: this.radius*2 };
    }
  }

  let rings = [];
  let spawnTimer = 0;
  const spawnInterval = 1000;
  let lastTime = 0;
  let score = 0;

  function spawnRing() {
    const x = 20 + Math.random() * (canvas.width - 40);
    rings.push(new Ring(x, -30));
  }

  function rectsOverlap(r1, r2) {
    return !(r1.x + r1.width < r2.x ||
             r1.x > r2.x + r2.width ||
             r1.y + r1.height < r2.y ||
             r1.y > r2.y + r2.height);
  }

  function update(delta) {
    if (!player) return;

    if (player.targetX !== null) {
      const dx = player.targetX - player.x;
      if (Math.abs(dx) < player.speed) {
        player.x = player.targetX;
        player.targetX = null;
      } else {
        player.x += (dx > 0 ? player.speed : -player.speed);
      }
    }

    if (player.x < 0) player.x = 0;
    if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;

    spawnTimer += delta;
    if (spawnTimer > spawnInterval) {
      spawnTimer = 0;
      spawnRing();
    }

    for (let i = rings.length - 1; i >= 0; i--) {
      rings[i].update();
      if (rings[i].y - rings[i].radius > canvas.height) {
        rings.splice(i, 1);
        continue;
      }

      // collisione player
      const ringRect = rings[i].getRect();
      const playerRect = { x: player.x, y: player.y, width: player.width, height: player.height };
      if (rectsOverlap(ringRect, playerRect)) {
        rings.splice(i, 1);
        score++;
        scoreDisplay.textContent = `Fedi raccolte: ${score}`;
        if(score === 1) message.textContent = "Bravo! Continua cos√¨!";
        else if(score === 5) message.textContent = "Sei un vero raccoglitore d'amore!";
        else if(score === 10) message.textContent = "L'anima gemella ti applaude! üíï";
      }
    }
  }

  function draw() {
    if (!player) return;
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // sfondo gradiente
    const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
    grad.addColorStop(0, '#cce7ff');
    grad.addColorStop(1, '#fdf7f0');
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // disegna fedine
    rings.forEach(ring => ring.draw());

    // disegna player
    if(player.type === 'sposo') drawSposo(player.x, player.y);
    else drawSposa(player.x, player.y);
  }

  function gameLoop(timestamp = 0) {
    if (!lastTime) lastTime = timestamp;
    const delta = timestamp - lastTime;
    lastTime = timestamp;

    update(delta);
    draw();
    requestAnimationFrame(gameLoop);
  }

  function onInput(event) {
    if (!player) return;
    const rect = canvas.getBoundingClientRect();
    let x;
    if(event.touches) x = event.touches[0].clientX - rect.left;
    else x = event.clientX - rect.left;

    player.targetX = (x < canvas.width / 2) ? 20 : canvas.width - player.width - 20;
  }

  canvas.addEventListener('touchstart', onInput);
  canvas.addEventListener('mousedown', onInput);

  function startGame() {
    score = 0;
    scoreDisplay.textContent = `Fedi raccolte: ${score}`;
    rings = [];
    newPlayer();
    gameLoop();
  }

  startGame();

})();
</script>

</body>
</html>
